<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.wheelingcamp.manage.model.mapper.ManageMapper">
	
	<select id="selectAllMember">
		SELECT *
		FROM MEMBER
	</select>
	
  	<update id="updateMember">
	     UPDATE "MEMBER" SET
	     MEMBER_ID = #{memberId}
	     WHERE MEMBER_NO = #{memberNo}
  	</update>
  
  	<select id="latestMemberNo">
		<!-- 현재 시퀀스 번호 리턴 -->
 	</select>
	
	<!-- *********************************************************************************** -->
	
	<!-- 상품 개수 가져오기 -->
	<select id="getItemCount">
		<if test="categoryCode == 1">
			SELECT COUNT(ITEM_NO)
			FROM CAR C
			JOIN CAR_GRADE USING(CAR_GRADE_NO)
			JOIN ITEM USING (ITEM_NO)
			JOIN ITEM_CATEGORY USING (CATEGORY_CODE)
		</if>
		
		<if test="categoryCode == 2">
			SELECT COUNT(ITEM_NO)
			FROM CAMP_EQUIPMENT
			JOIN EQUIPMENT_CATEGORY USING (EQUIPMENT_CATEGORY_CODE)
			JOIN ITEM USING (ITEM_NO)
			JOIN ITEM_CATEGORY USING (CATEGORY_CODE)
		</if>
		
		<if test="categoryCode == 3">
			SELECT COUNT(P.PACKAGE_NO)
			FROM PACKAGE P
			JOIN ITEM I ON (P.PACKAGE_NO = I.ITEM_NO)
			JOIN ITEM_CATEGORY IC ON (IC.CATEGORY_CODE = I.CATEGORY_CODE)
		</if>
	</select>
	
	<!-- 모든 차 목록 탐색 -->
	<select id="selectCarAll">
		SELECT DISTINCT ITEM_NO, CATEGORY_NAME, ITEM_VIEW_COUNT , CAR_NAME , CAR_GRADE_NO, 
				CAR_GRADE_NAME, CAR_SLEEP_CAPACITY , CAR_PASSENGERS , CAR_RENT_PRICE , CAR_FUEL , 
				IMG_PATH || IMG_RENAME "THUMBNAIL"
		FROM CAR C
		JOIN CAR_GRADE USING(CAR_GRADE_NO)
		JOIN ITEM USING (ITEM_NO)
		JOIN ITEM_CATEGORY USING (CATEGORY_CODE)
		LEFT JOIN (SELECT * FROM ITEM_IMG WHERE IMG_ORDER = 0) USING(ITEM_NO)
		LEFT JOIN CAR_STOCK USING (ITEM_NO)
		WHERE CATEGORY_CODE = 1
		ORDER BY
			<!-- 최신순 -->
			<if test="sortNo == 0">
				ITEM_NO DESC
			</if>
			
			<!-- 높은 가격순 -->
			<if test="sortNo == 1">
				CAR_RENT_PRICE DESC, ITEM_NO DESC
			</if>
			
			<!-- 낮은 가격순 -->
			<if test="sortNo == 2">
				CAR_RENT_PRICE, ITEM_NO DESC
			</if>
			
			<!-- 조회수 순 -->
			<if test="sortNo == 3">
				ITEM_VIEW_COUNT DESC, ITEM_NO DESC
			</if>
	</select>

  	<!--모든 캠핑용품 목록 탐색 -->
	<select id="selectCampEquipmentAll">
		SELECT ITEM_NO, CATEGORY_CODE, CATEGORY_NAME, ITEM_VIEW_COUNT,
				EQUIPMENT_CATEGORY_CODE, EQUIPMENT_CATEGORY_NAME, EQUIPMENT_NAME,
				EQUIPMENT_RENT_PRICE, EQUIPMENT_RENT_COUNT,
				EQUIPMENT_SELL_PRICE, EQUIPMENT_SELL_COUNT,
				IMG_PATH || IMG_RENAME "THUMBNAIL"
		FROM CAMP_EQUIPMENT
		JOIN EQUIPMENT_CATEGORY USING (EQUIPMENT_CATEGORY_CODE)
		JOIN ITEM USING (ITEM_NO)
		JOIN ITEM_CATEGORY USING (CATEGORY_CODE)
		LEFT JOIN (SELECT * FROM ITEM_IMG WHERE IMG_ORDER = 0) USING(ITEM_NO)
	</select>
	
	<!-- 모든 패키지 목록 탐색 -->
	<select id="selectPackageAll">
		SELECT I.ITEM_NO, I.CATEGORY_CODE, CATEGORY_NAME, ITEM_VIEW_COUNT ,
				P.PACKAGE_PRICE, P.PACKAGE_NAME,
				IMG_PATH || IMG_RENAME "THUMBNAIL"
		FROM PACKAGE P
		JOIN ITEM I ON (P.PACKAGE_NO = I.ITEM_NO)
		JOIN ITEM_CATEGORY IC ON (IC.CATEGORY_CODE = I.CATEGORY_CODE)
		LEFT JOIN (SELECT * FROM ITEM_IMG WHERE IMG_ORDER = 0) II ON (P.PACKAGE_NO = II.ITEM_NO)
	</select>
	
	<!-- *********************************************************************************** -->
	
</mapper>
