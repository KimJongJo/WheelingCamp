<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.wheelingcamp.badge.model.mapper.BadgeMapper">
	<!-- 뱃지 resultMap -->
	<resultMap type="Badge" id="badge_resultMap">
		<id property="badgeNo" column="BADGE_NO"/>
		<result property="badgeName" column="BADGE_NAME"/>
		<result property="badgeContents" column="BADGE_CONTENTS"/>
		<result property="badgeImg" column="BADGE_IMG"/>
		<result property="badgeDate" column="BADGE_DATE"/>
		<result property="badgeFl" column="BADGE_FL"/>
	</resultMap>
	
	
	
	
	<!-- 마이페이지 내 뱃지 목록 조회 -->
	<select id="selectBadgeList" resultMap="badge_resultMap">
		SELECT BADGE_NO, BADGE_NAME, BADGE_CONTENTS, BADGE_IMG,BADGE_DATE,BADGE_FL
		FROM "BADGE"
		JOIN "MEMBER_BADGE" USING(BADGE_NO)
		WHERE MEMBER_NO = #{memberNo}
	</select>
	
	<!-- 마이페이지 내 뱃지 수 조회 -->
	<select id="getBadgeCount"> 
		SELECT COUNT(*) FROM BADGE
		JOIN MEMBER_BADGE USING(BADGE_NO)
		WHERE MEMBER_NO = #{memberNo}
		AND BADGE_FL = 'Y'
	</select>  
	
	<!-- 대표뱃지 선택 -->
	
		<!-- 뱃지 N으로 전부 리셋하기 -->
	<update id="resetSelectedBadge">
		UPDATE MEMBER_BADGE
	    SET SELECTED_BADGE = 'N'
	    WHERE MEMBER_NO =#{memberNo}
    </update>

		<!-- 선택한 뱃지의 SELECTED_BADGE 값을 'Y'로 설정 -->
    <update id="selectedBadge" parameterType="map" >
	    UPDATE MEMBER_BADGE
	    SET SELECTED_BADGE = 'Y'
	    WHERE BADGE_NO = #{badgeNo}
	    AND MEMBER_NO= #{memberNo}
	</update>

</mapper>
